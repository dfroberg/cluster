---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: kubernetes-pfsense-controller
  namespace: networking
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://travisghansen.github.io/kubernetes-pfsense-controller-chart/
      chart: kubernetes-pfsense-controller
      version: 0.1.2
      sourceRef:
        kind: HelmRepository
        name: kpc-charts
        namespace: flux-system
  values:
    pfsense:
      url: ${PFSENSE_URL}
      insecure: ${PFSENSE_INSECURE}
      username: ${PFSENSE_USERNAME}
      password: ${PFSENSE_PASSWORD}
    haproxy-declarative:
      enabled: true
    haproxy-ingress-proxy:
      enabled: true
      ingressLabelSelector:
      ingressFieldSelector:
      # works in conjunction with the ingress annotation 'haproxy-ingress-proxy.pfsense.org/enabled'
      # if defaultEnabled is empty or true, you can disable specific ingresses by setting the annotation to false
      # if defaultEnabled is false, you can enable specific ingresses by setting the annotation to true
      defaultEnabled: true
      defaultFrontend: http-80
      defaultBackend: traefik
      allowedHostRegex: "/.${SECRET_DOMAIN}$$/"
    metallb:
      enabled: true
      nodeLabelSelector:
      nodeFieldSelector:
      # configMap: "metallb-system/config"
      #bgp-implementation: frr
      #options:
      #  frr:
      #    template:
      #      peergroup: metallb
    pfsense-dns-services:
      enabled: true
      serviceLabelSelector:
      serviceFieldSelector:
      allowedHostRegex: "/.${SECRET_DOMAIN}$$/"
      dnsBackends:
        dnsmasq:
          enabled: true
        unbound:
          enabled: true
    pfsense-dns-ingresses:
      enabled: true
      ingressLabelSelector:
      ingressFieldSelector:
      # works in conjunction with the ingress annotation 'dns.pfsense.org/enabled'
      # if defaultEnabled is empty or true, you can disable specific ingresses by setting the annotation to false
      # if defaultEnabled is false, you can enable specific ingresses by setting the annotation to true
      defaultEnabled: true
      allowedHostRegex: "/.${SECRET_DOMAIN}$$/"
      dnsBackends:
        dnsmasq:
          enabled: true
        unbound:
          enabled: true