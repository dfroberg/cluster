---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: kubed
  namespace: kube-system
spec:
  interval: 5m
  chart:
    spec:
      chart: kubed
      version: v0.12.0
      sourceRef:
        kind: HelmRepository
        name: appscode-charts
        namespace: flux-system
      interval: 5m
  values:
    image:
      repository: appscode/kubed
      tag: v0.12.0
    updateStrategy: RollingUpdate

    config:
      # Set cluster-name to something meaningful to you, say, prod, prod-us-east, qa, etc.
      # so that you can distinguish notifications sent by kubed
      clusterName: lab-cluster
      # If set, configmaps and secrets from only this namespace will be synced
      #configSourceNamespace: ""
      # kubeconfig file content for configmap and secret syncer
      #kubeconfigContent: ""
    #  additionalOptions:
    #    - --authentication-skip-lookup

    # Container image pull policy
    imagePullPolicy: IfNotPresent
    # If true, installs Kubed operator as critical addon
    criticalAddon: false
    # Log level for operator
    logLevel: 1 # must be numerical default: 3
    # If true, sends usage analytics
    enableAnalytics: true
    # Security options the operator pod should run with.
    podSecurityContext:  
      # ensure that s/a token is readable xref: https://issues.k8s.io/70679
      fsGroup: 65535

    serviceAccount:
      # Specifies whether a service account should be created
      create: true

    apiserver:
      enabled: true

    tolerations:
      - effect: NoExecute
        operator: Exists
      - effect: NoSchedule
        operator: Exists
      - effect: NoExecute
        key: node.kubernetes.io/not-ready
        operator: Exists
        tolerationSeconds: 300
      - effect: NoExecute
        key: node.kubernetes.io/unreachable
        operator: Exists
        tolerationSeconds: 300
    metrics:
      create: true
    resources:
      requests:
        cpu: 50m
        memory: 263M
      limits:
        cpu: 50m
        memory: 263M
